---
description: Instruções operacionais do projeto multi-agente frontend (Orchestrator + Workers), incluindo padrões de execução autônoma, qualidade e validação.
applyTo: "{.github/agents/**/*.md,.github/prompts/**/*.md,.vscode/mcp.json,.vscode/agent-orchestration.config.yaml}"
---

# 1) Quando carregar estas instruções

Carregue estas instruções automaticamente quando a tarefa envolver qualquer um dos cenários abaixo:

1. Criação/edição de arquivos em `.github/agents/**`.
2. Criação/edição de prompts em `.github/prompts/**`.
3. Alterações de configuração de MCP e orquestração (`.vscode/mcp.json`, `.vscode/agent-orchestration.config.yaml`).
4. Solicitações de desenho/ajuste de fluxo multi-agente, handoff, validação, paralelização, state machine, observabilidade ou escalonamento.

> Se houver conflito entre instruções, seguir a ordem de precedência: **System > Developer > Instructions > User**.

# 2) Contexto do projeto

Este repositório implementa um pipeline de desenvolvimento frontend com 5 agentes:

- `1. Workflow Orchestrator` (coordenação)
- `2. Figma Analyser`
- `3. Frontend`
- `4. Browser Validator`
- `5. Tech Lead Validator`

Objetivo do sistema: executar tarefas de frontend com qualidade, rastreabilidade e decisões explícitas, evitando one-shot e reduzindo retrabalho.

# 3) Princípios obrigatórios

1. **Execução autônoma com controle**: avançar sem pedir confirmações desnecessárias.
2. **Context isolation**: handoff mínimo e suficiente; sem histórico irrelevante.
3. **Paralelização consciente**: Browser + Tech Lead em paralelo quando as dependências permitirem.
4. **Decision routing**: usar gate de decisão após validações (evitar cascata $O(n^2)$).
5. **State machine explícita**: sem transições implícitas.
6. **Iteração com rastreamento**: medir regressão entre ciclos.
7. **Feedback obrigatório**: chamar `mcp-feedback-enhanced`:
	 - após cada conclusão da etapa Tech Lead;
	 - no fechamento consolidado da tarefa.

# 4) Contrato mínimo de handoff (obrigatório)

Todo handoff entre agentes deve seguir este envelope:

```yaml
trace_id: string
task_id: string
objective: string
input_artifacts:
	- type: file|url|spec|diff
		ref: string
acceptance_criteria: string[]
constraints: string[]
output_schema:
	type: string
	required: string[]
error_handling:
	on_missing_artifact: BLOCKED
	on_timeout: PARTIAL
```

Regras adicionais:

- `max_context_chars <= 6000`
- Não enviar chain-of-thought bruto.
- Se faltar artefato crítico, retornar `BLOCKED` com `missing_artifacts[]`.

# 5) Fluxo padrão (obrigatório)

1. **INTAKE**: classificar tarefa e gerar `trace_id/task_id`.
2. **CONTEXT_LOAD**: carregar padrões relevantes (memória/configuração).
3. **PLANNING**: decompor em subtarefas com dependências explícitas.
4. **FIGMA_ANALYSIS** (se aplicável).
5. **IMPLEMENTATION**.
6. **VALIDATION_PARALLEL**: Browser Validator + Tech Lead Validator.
7. **DECISION_GATE**:
	 - crítico > 0 → `REWORK_FRONTEND`
	 - médio > 0 → `REWORK_OPTIONAL_GATE`
	 - timeout relevante → `SMART_ESCALATION`
	 - sem issues impeditivas → `APPROVED`
8. **FEEDBACK OBRIGATÓRIO**:
	 - pós-Tech Lead
	 - pós-consolidação final

# 6) Estado e transições

Estados permitidos:

- `INTAKE`, `CONTEXT_LOAD`, `PLANNING`, `FIGMA_ANALYSIS`, `IMPLEMENTATION`,
- `VALIDATION_PARALLEL`, `DECISION_GATE`, `REWORK`, `SMART_ESCALATION`,
- `APPROVED`, `BLOCKED`, `CANCELLED`.

Regras:

- Toda transição deve ser registrada (`state_transition`) com `trace_id`.
- Não saltar estados fora da matriz de transição definida.

# 7) Qualidade e segurança

Sempre verificar:

- Tipagem e consistência de schema/frontmatter.
- Acessibilidade e responsividade nas validações de UI.
- Segurança básica (XSS, exposição de dados sensíveis, validações insuficientes).
- Regressão por iteração (`critical_bugs`, `medium_bugs`, `test_pass_rate`, `a11y_score`).

# 8) Regras de prompts e agentes

1. Prompts devem ser acionáveis e sem ambiguidade.
2. Evitar duplicação de políticas em múltiplos arquivos; priorizar fonte canônica quando existir.
3. Toda etapa deve explicitar entrada, saída e critérios de aceite.
4. Se a etapa depender de revisão Tech Lead, incluir pós-condição de feedback obrigatório.

# 9) Observabilidade mínima

Registrar eventos por tarefa:

- `handoff_sent`
- `handoff_done`
- `quality_gate`
- `escalation_triggered`
- `feedback_collected`

Todos os eventos devem estar vinculados a `trace_id`.

# 10) Critério de conclusão da tarefa

Só concluir uma tarefa quando:

1. Subtarefas dependentes estiverem `completed` ou `blocked` com justificativa.
2. Decision gate estiver aplicado e documentado.
3. Feedback pós-Tech Lead estiver coletado/registrado.
4. Feedback de fechamento final estiver coletado/registrado.
5. Relatório final estiver emitido com próximos passos.

# 11) Anti-padrões proibidos

- One-shot sem iteração crítica.
- Handoff com contexto excessivo e não relacionado.
- Marcar conclusão sem feedback obrigatório.
- Encerrar sem validação e sem estado final explícito.